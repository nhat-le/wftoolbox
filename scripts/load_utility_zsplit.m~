goodrawfiles = {'2021-10-01_1_f25', '2021-10-04_1_f25',...
    '2021-10-05_1_f25', '2021-10-06_1_f25'};

matfilenames = {'allData_extracted_e57_030221pix.mat',...
    'allData_extracted_e57_030321pix.mat',...
    'allData_extracted_f01_030921pix.mat',...
    'allData_extracted_f01_043021pix.mat',...
    'allData_extracted_F02_030121pix.mat',...
    'allData_extracted_f02_030321pix.mat',...
    'allData_extracted_f02_030421pix.mat',...
    'allData_extracted_f02_043021pix.mat',...
    'allData_extracted_f03_031921pix.mat',...
    'allData_extracted_f03_032221pix.mat',...
    'allData_extracted_f03_041921pix.mat',...
    'allData_extracted_f03_042021pix.mat',...
    'allData_extracted_f03_042121pix.mat',...
    'allData_extracted_f04_030321pix.mat',...
    'allData_extracted_f04_031921pix.mat',...
    'allData_extracted_f04_042821pix.mat',...
    'allData_extracted_f25_100121pix.mat',...
    'allData_extracted_f25_100421pix.mat',...
    'allData_extracted_f25_100521pix.mat',...
    'allData_extracted_f25_100621pix.mat'};
%             'allData_extracted_f01_030921pix.h5',... corrupted

% h5filenames = {
%             'allData_extracted_e57_030421pix.h5',...
%             'allData_extracted_f01_030421pix.h5',...
%             'allData_extracted_f01_043021pix.h5',...
%             'allData_extracted_f02_030221pix.h5',...
%             'allData_extracted_f03_030121pix.h5',...
%             'allData_extracted_f04_030221pix.h5'};

h5filenames = {'allData_extracted_f01_030421pix.h5',...
            'allData_extracted_f02_030221pix.h5',...
            'allData_extracted_f03_030121pix.h5',...
            'allData_extracted_f04_030221pix.h5',...
            'allData_extracted_e57_030421pix.h5',...
            'allData_extracted_f01_043021pix.h5'};

batch_names = h5filenames;

        

%%
opts.date = '111821';

if strcmp(batch_names{1}(end-3:end), 'mat')
    opts.filedir = '/Volumes/GoogleDrive/Other computers/ImagingDESKTOP-AR620FK/processed';
else
    opts.filedir = '/Volumes/GoogleDrive/Other computers/ImagingDESKTOP-AR620FK/processed/hdf5';
end
opts.zdir = '/Users/minhnhatle/Dropbox (MIT)/Sur/MatchingSimulations/expdata'; %directory that stores the zstate data
opts.savedir = '/Volumes/GoogleDrive/Other computers/ImagingDESKTOP-AR620FK/processed/regression-split';
opts.window = 5;
opts.roisize = 9;
opts.xgrid = 10:3:110;
opts.ygrid = 10:3:110;
opts.subset = -1;

%%

for i = 1:%numel(batch_names)
    tic
    
        fprintf('------- Processing file %d of %d: %s... ------\n', i, ...
            numel(batch_names), batch_names{i});
        opts.filename = batch_names{i};
        parts = strsplit(opts.filename, '_');
        opts.animal = lower(parts{3});
        opts.sessid = parts{4}(1:6);
        
        
%         opts.filename = sprintf('allData_extracted_%s_%s%s%spix.mat', parts{3},...
%             dateparts{2}, dateparts{3}, dateparts{1}(3:4));
        utils.do_wf_regression_zsplit(opts);
        
     
        fprintf('Error loading file %s\n', opts.filename);
        continue
        
    
    toc
end

